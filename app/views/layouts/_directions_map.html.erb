<div id="map" style='width: 100%; height: 90vh;'></div>
<script>
  var mapStyle = [
      {
        "featureType": "landscape",
        "stylers": [
          {
            "hue": "#FFA800"
          },
          {
            "saturation": 0
          },
          {
            "lightness": 0
          },
          {
            "gamma": 1
          }
        ]
      },

      {
        "featureType": "road.highway",
        "stylers": [
          {
            "hue": "#53FF00"
          },
          {
            "saturation": -73
          },
          {
            "lightness": 40
          },
          {
            "gamma": 1
          }
        ]
      },

      {
        "featureType": "road.arterial",
          "stylers": [
            {
              "hue": "#FBFF00"
            },
            {
              "saturation": 0
            },
            {
              "lightness": 0
            },
            {
              "gamma": 1
            }
          ]
      },

      {
        "featureType": "road.local",
        "stylers": [
          {
            "hue": "#00FFFD"
          },
          {
            "saturation": 0
          },
          {
            "lightness": 30
          },
          {
            "gamma": 1
          }
        ]
      },

      {
        "featureType": "water",
        "stylers": [
          {
            "hue": "#00BFFF"
          },
          {
            "saturation": 6
          },
          {
            "lightness": 8
          },
          {
            "gamma": 1
          }
        ]
      },

      {
        "featureType": "poi",
        "stylers": [
          {
            "hue": "#679714"
          },
          {
            "saturation": 33.4
          },
          {
            "lightness": -25.4
          },
          {
            "gamma": 1
          }
        ]
      }
  ]

  function initialize() {
    var map = new google.maps.Map(document.getElementById('map'), mapOptions);
    var mapOptions = {
      zoom: 8,
      center: new google.maps.LatLng(<%= @walk.start_location.latitude %>, <%= @walk.start_location.longitude %>),
      styles: mapStyle
    };

    var directionsService = new google.maps.DirectionsService();
    var directionsDisplay = new google.maps.DirectionsRenderer();
    var waypoints = <%= @walk.waypoints.html_safe %>;
    var wypnts = [];
    for (var i = 0; i < waypoints.length; i++) {
      wypnts.push({
          location: new google.maps.LatLng(waypoints[i].latitude, waypoints[i].longitude),
          stopover: false
      });
    }

    var start = new google.maps.LatLng(<%= @walk.start_location.latitude %>,<%= @walk.start_location.longitude %>)
    var finish = new google.maps.LatLng(<%= @walk.start_location.latitude %>, <%= @walk.start_location.longitude %>)

    var directionsRequest = {
      origin: start,
      destination:finish,
      waypoints: wypnts,
      optimizeWaypoints: true,
      travelMode: google.maps.DirectionsTravelMode.WALKING,
      unitSystem: google.maps.UnitSystem.IMPERIAL
    };

    directionsService.route(directionsRequest, function(response, status) {
      //Check if request is successful.
      if (status == google.maps.DirectionsStatus.OK) {
        var distance = document.getElementById('distance');
        distance.innerHTML = (response.routes[0].legs[0].distance.text) + distance.innerHTML;
        var stepsLength = response.routes[0].legs[0].steps.length;
        for (var i = 0; i < stepsLength; i++) {
          var steps = document.getElementById('steps');
          var instructions = response.routes[0].legs[0].steps[i].instructions;
          var stepLength = response.routes[0].legs[0].steps[i].distance.text;
          steps.innerHTML = steps.innerHTML + '<li>' + (instructions) + '</li>' + ' ' + '<p id= "tiny">' + (stepLength) + '</p>';
        }
        directionsDisplay.setDirections(response); //Display the directions result
      }
    });

    directionsDisplay.setMap(map);
  };

  google.maps.event.addDomListener(window, 'load', initialize);

</script>
