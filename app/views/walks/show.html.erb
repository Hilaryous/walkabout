<%= @walk.name %>
<div id= "distance">
</div>
<div id="steps">
</div>
<div id="route">
  <div class="start_location">
    <%= @walk.start_location.address %>
  </div>

  <div class="sights">
    <% @walk.locations.each do |location| %>
      <%= location.sight.name %>
      <%= location.address %>
    <% end %>
  </div>
</div>
<div id="map" style='width: 100%; height: 90vh;'></div>
<script>
  function initialize() {
    var map = new google.maps.Map(document.getElementById('map'), mapOptions);
    var mapOptions = {
      zoom: 8,
      center: new google.maps.LatLng(<%= @walk.start_location.latitude %>, <%= @walk.start_location.longitude %>)
    };

    var directionsService = new google.maps.DirectionsService();
    var directionsDisplay = new google.maps.DirectionsRenderer();

    var directionsRequest = {
      origin: new google.maps.LatLng(<%= @walk.start_location.latitude %>,<%= @walk.start_location.longitude %>),
      destination: new google.maps.LatLng(<% if @walk.locations.first %>
                                            <%= @walk.locations.first.latitude %>
                                          <% end %>,
                                          <% if @walk.locations.first %>
                                            <%= @walk.locations.first.longitude %>
                                          <% end %>),
      travelMode: google.maps.DirectionsTravelMode.WALKING,
      unitSystem: google.maps.UnitSystem.IMPERIAL
    };

    directionsService.route(directionsRequest, function(response, status) {
      //Check if request is successful.
      if (status == google.maps.DirectionsStatus.OK) {
        console.log(status);
        var distance = document.getElementById('distance');
        distance.innerHTML = (response.routes[0].legs[0].distance.text);
        var stepsLength = response.routes[0].legs[0].steps.length;
        for (var i = 0; i < stepsLength; i++) {
          var steps = document.getElementById('steps');
          console.log((response.routes[0].legs[0].steps[i].instructions));
          steps.innerHTML = steps.innerHTML + (response.routes[0].legs[0].steps[i].instructions);
        }
        directionsDisplay.setDirections(response); //Display the directions result
      }
    });

    directionsDisplay.setMap(map);
  };

  google.maps.event.addDomListener(window, 'load', initialize);

</script>
